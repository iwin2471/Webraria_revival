(()=>{var m=class{constructor(){}static getInstance(){return this.instance==null&&(this.instance=new m),this.instance}initElement(e){this.element=document.getElementById(e),this.context=this.element.getContext("webgl2"),this.element.height=this.element.clientHeight,this.element.width=this.element.clientWidth}getContext(){return this.context}getElement(){return this.element}},n=m;var v=class{constructor(e,t){this.x=e,this.y=t}setXY(e,t){this.x=e,this.y=t}toString(){return`${this.x} ${this.y}`}},C=v;var w=class{constructor(e,t){this.sprite=new Image;this.loaded=!1;this.movementSpeed=8;this.canJump=!1;this.position=new C;this.width=8;this.height=16;this.name=e,this.sprite.src=t,this.sprite.onload=()=>{this.loaded=!0}}get speed(){return this.movementSpeed}setPosition(e,t){this.position.setXY(e,t)}get x(){return this.position.x}get y(){return this.position.y}clearRect(){n.getInstance().getContext().clearRect(this.x,this.y,this.width,this.height)}isMonster(){return!1}onUpdate(){}},R=w;var f=class extends R{constructor(e,t){super(e,t);this.sideMovementSpeed=8;this.jumpForce=16}onUpdate(){}},E=f;var b=class{constructor(){this.worldTerrainSave=new Array;this.tileMap={tile:{dirt:[new Image,new Image,new Image,new Image],water:[new Image,new Image,new Image,new Image]},ore:[new Image,new Image,new Image,new Image,new Image]};this.tileMap.tile.dirt[0].src="Resource/Tiles/dirt/floor_dirt01.png",this.tileMap.tile.dirt[1].src="Resource/Tiles/dirt/floor_dirt02.png",this.tileMap.tile.dirt[2].src="Resource/Tiles/dirt/floor_dirt03.png",this.tileMap.tile.dirt[3].src="Resource/Tiles/dirt/floor_dirt04.png",this.tileMap.tile.water[0].src="Resource/Tiles/liquid/water_opacity_90.png",this.tileMap.tile.water[0].src="Resource/Tiles/liquid/water_opacity_95.png",this.tileMap.tile.water[0].src="Resource/Tiles/liquid/water_surface_opacity_90.png",this.tileMap.tile.water[0].src="Resource/Tiles/liquid/water_surface_opacity_95.png",this.tileMap.ore[0].src="Resource/Tiles/Mineral/copperS.png",this.tileMap.ore[1].src="Resource/Tiles/Mineral/iro.png",this.tileMap.ore[2].src="Resource/Tiles/Mineral/dia2.png",this.tileMap.ore[3].src="Resource/Tiles/object/stone.png",this.tileMap.ore[4].src="Resource/Tiles/dirt/floor_dirt04.png";for(let e=0;e<n.getInstance().getElement().width;e++)this.worldTerrainSave[e]=new Array}static getInstance(){return this.instance==null&&(this.instance=new b),this.instance}},d=b;d.tileSize=8;var o=d;var x=class{constructor(){this.canvas=n.getInstance();this.element=this.canvas.getElement();this.context=this.canvas.getContext();this.playerList=new Array}onMainPlayerEnter(e){this.canvas=n.getInstance(),this.element=this.canvas.getElement(),this.context=this.canvas.getContext(),window.addEventListener("keydown",({code:t})=>this.movement(e,t)),window.addEventListener("keyup",this.onKeyUp),this.onWorldEnter(e)}onWorldEnter(e){this.playerList.push(e)}movement(e,t){switch(t){case"ArrowLeft":o.getInstance().worldTerrainSave[e.position.x-e.speed][e.position.y]||(e.clearRect(),e.position.x-=e.speed);break;case"Space":case"ArrowUp":if(!e.canJump)break;e.clearRect(),e.position.y-=e.jumpForce,e.canJump=!1;break;case"ArrowRight":o.getInstance().worldTerrainSave[e.position.x+e.speed][e.position.y]||(e.clearRect(),e.position.x+=e.speed);break;case"ArrowDown":e.clearRect(),e.position.y+=e.jumpForce;break}}onKeyUp({keyCode:e,type:t}){}onUpdate(e){this.playerList.forEach(t=>{t.clearRect(),o.getInstance().worldTerrainSave[t.position.x][t.position.y+16]?t.canJump=!0:t.position.y+=2,this.context.rect(t.position.y,t.position.y,t.width,t.height),this.context.fillStyle="rgba(0,0,0,0)",this.context.fill(),this.context.drawImage(t.sprite,t.position.x,t.position.y,t.width,t.height)})}},S=x;var p=class{constructor(e,t,r){this.x=0;this.pos=[];for(this.amp=e,this.wl=t,this.fq=1/t,this.psng=new L,this.a=this.psng.next(),this.b=this.psng.next(),this.pos=[];this.x<r;)this.x%this.wl==0?(this.a=this.b,this.b=this.psng.next(),this.pos.push(this.a*this.amp)):this.pos.push(this.interpolate(this.a,this.b,this.x%this.wl/this.wl)*this.amp),this.x++}interpolate(e,t,r){let s=r*Math.PI,i=(1-Math.cos(s))*.5;return e*(1-i)+t*i}generateNoise(e,t,r,s,i){let h=[];for(let u=0;u<r;u++)h.push(new p(e,t,i)),e/=s,t/=s;return h}combineNoise(e){let t=[];for(let r=0,s=0,i=0;r<e[0].pos.length;r++){for(s=0,i=0;i<e.length;i++)s+=e[i].pos[r];t.push(s)}return t}},M=p,L=class{constructor(){this.Z=0;this.M=4294967296;this.A=1664525;this.C=1;this.Z=Math.floor(Math.random()*this.M)}next(){return this.Z=(this.A*this.Z+this.C)%this.M,this.Z/this.M-.5}};var I=class{constructor(){this.canvas=n.getInstance();this.cnt=0;this.lastLayer=[];this.layerCnt=0}makeSomeNoise(){let e=new M(128,128,n.getInstance().getElement().width);return e.combineNoise(e.generateNoise(128,128,8,2,this.canvas.getElement().width))}generateWorld(){this.terrain=o.getInstance();let e=this.makeSomeNoise(),t=this.canvas.getElement(),r=this.canvas.getContext(),s=o.getInstance(),i=t.height,h=t.width,u=i/2,g=!1;setTimeout(()=>{for(let l=0;l<h;l++){let P=u+e[l];g=!1;for(let c=0;c<i;c++)if(s.worldTerrainSave[l][c]=!1,c>P&&(s.worldTerrainSave[l][c]=!0,l%o.tileSize==0&&c%o.tileSize==0))if(g)r.drawImage(this.terrain.tileMap.tile.dirt[3],l,c);else{let k=Math.floor(Math.random()*3);r.drawImage(this.terrain.tileMap.tile.dirt[k],l,c),g=!0}}},500)}},_=I;var T=class{constructor(){this.worldgen=new _}generateWorld(){this.worldgen.generateWorld()}},A=T;var y=class{constructor(){this.canvas=n.getInstance();this.element=this.canvas.getElement();this.context=this.canvas.getContext();this.world=new A;this.frame=0;this.test=new S;this.registeredControllers=new Array(this.test)}startGame(e){let t=new E(e,"Resource/Character/3.png");this.terrian=o.getInstance(),this.canvas=n.getInstance(),this.element=this.canvas.getElement(),this.context=this.canvas.getContext(),this.elemLeft=this.element.offsetLeft+this.element.clientLeft,this.elemTop=this.element.offsetTop+this.element.clientTop,this.element.onclick=({clientX:r,clientY:s})=>{let i=r-this.element.getBoundingClientRect().left,h=s-this.element.getBoundingClientRect().top;console.log(i,h),console.log(this.terrian.worldTerrainSave[i][h])},t.setPosition(0,0),this.test.onMainPlayerEnter(t),this.world.generateWorld(),this.onUpdate(this.frame)}onUpdate(e){this.frame=e,this.registeredControllers.forEach(t=>{t.onUpdate(e)}),window.requestAnimationFrame(()=>this.onUpdate(++e))}},B=y;function W(){let a=new B;n.getInstance().initElement("main_canvas"),a.startGame("Johnsu")}W();})();
//# sourceMappingURL=bundle.js.map
